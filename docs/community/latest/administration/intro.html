<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>KubeVirt Latest | Installation & Administration | Installation</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <link href="../../latest/_stylesheets/asciibinder.css" rel="stylesheet" />

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="../../latest/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="../../latest/_images/favicon.ico"><![endif]-->
  <meta content="AsciiBinder" name="application-name">
</head>
<body>
  <div class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="https://kubevirt.io/"><img alt="Kubevirt" height="64px" src="../../latest/_images/KubeVirt_icon.png"></a>
      </div>
    </div>
  </div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../index.html">Documentation</a>
      </li>
      <li class="hidden-xs active">
        <a href="../welcome/index.html">KubeVirt Latest</a>
      </li>
      <li class="hidden-xs active">
        <a href="../administration/intro.html">Installation & Administration</a>
      </li>
      
      <li class="hidden-xs active">
        Installation
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>Welcome
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../welcome/index.html">Welcome</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>Release Notes
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../release-notes/changelog.html">Changelog</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-right"></span>Architecture
      </a>
      <ul id="topicGroup2" class="collapse  list-unstyled">
            <li><a class="" href="../architecture/virtual-machine.html">Virtual Machines</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-down"></span>Installation & Administration
      </a>
      <ul id="topicGroup3" class="collapse in list-unstyled">
            <li><a class=" active" href="../administration/intro.html">Installation</a></li>
            <li><a class="" href="../administration/api-validation.html">Webhooks</a></li>
            <li><a class="" href="../administration/authorization.html">Authorization</a></li>
            <li><a class="" href="../administration/monitoring.html">Monitoring</a></li>
            <li><a class="" href="../administration/annotations_and_labels.html">Annotations and Labels</a></li>
            <li><a class="" href="../administration/unresponsive-nodes.html">Unresponsive node handling</a></li>
            <li><a class="" href="../administration/node-eviction.html">Node eviciton</a></li>
            <li><a class="" href="../administration/image-upload.html">Image upload</a></li>
            <li><a class="" href="../administration/live-migration.html">Live Migration</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup4">
        <span id="tgSpan4" class="fa fa-angle-right"></span>Creating Virtual Machines
      </a>
      <ul id="topicGroup4" class="collapse  list-unstyled">
            <li><a class="" href="../creating-virtual-machines/intro.html">Introduction</a></li>
            <li><a class="" href="../creating-virtual-machines/virtualized-hardware-configuration.html">Devices</a></li>
            <li><a class="" href="../creating-virtual-machines/disks-and-volumes.html">Disks and Volumes</a></li>
            <li><a class="" href="../creating-virtual-machines/interfaces-and-networks.html">Interfaces and Networks</a></li>
            <li><a class="" href="../creating-virtual-machines/dedicated-cpu.html">Guaranteed CPU usage</a></li>
            <li><a class="" href="../creating-virtual-machines/startup-scripts.html">cloud-init</a></li>
            <li><a class="" href="../creating-virtual-machines/guest-operating-system-information.html">Associating Guest Informations</a></li>
            <li><a class="" href="../creating-virtual-machines/virtio-win.html">virtio drivers for Microsoft Windows</a></li>
            <li><a class="" href="../creating-virtual-machines/presets.html">Presets</a></li>
            <li><a class="" href="../creating-virtual-machines/probes.html">Probes</a></li>
            <li><a class="" href="../creating-virtual-machines/run-strategies.html">Run Strategies</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup5">
        <span id="tgSpan5" class="fa fa-angle-right"></span>Using Virtual Machines
      </a>
      <ul id="topicGroup5" class="collapse  list-unstyled">
            <li><a class="" href="../using-virtual-machines/usage.html">Usage</a></li>
            <li><a class="" href="../using-virtual-machines/life-cycle.html">Starting and Stopping</a></li>
            <li><a class="" href="../using-virtual-machines/graphical-and-console-access.html">Console Access (Serial and Graphical)</a></li>
            <li><a class="" href="../using-virtual-machines/assigning-vms-to-nodes.html">Node placement</a></li>
            <li><a class="" href="../using-virtual-machines/dns.html">DNS Integration</a></li>
            <li><a class="" href="../using-virtual-machines/expose-service.html">Service Integration</a></li>
            <li><a class="" href="../using-virtual-machines/create-networkpolicy.html">Assigning Network Policies</a></li>
            <li><a class="" href="../using-virtual-machines/overcommit.html">Memory over-commit</a></li>
            <li><a class="" href="../using-virtual-machines/virtual-machine-replica-set.html">Virtual Machine Replica Set</a></li>
            <li><a class="" href="../using-virtual-machines/vmctl.html">vmctl</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup6">
        <span id="tgSpan6" class="fa fa-angle-right"></span>Working with Templates
      </a>
      <ul id="topicGroup6" class="collapse  list-unstyled">
            <li><a class="" href="../templates/common-templates.html">Introduction</a></li>
            <li><a class="" href="../templates/using-templates.html">Using templates</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup7">
        <span id="tgSpan7" class="fa fa-angle-right"></span>Web Interface
      </a>
      <ul id="topicGroup7" class="collapse  list-unstyled">
            <li><a class="" href="../web-interface/web-interface.html">Web Interface</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Installation</h2>
        </div>
        <div class="sect1">
<h2 id="installation"><a class="anchor" href="#installation"></a>Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>KubeVirt is a virtualization add-on to Kubernetes and this guide assumes
that a Kubernetes cluster is already installed.</p>
</div>
<div class="paragraph">
<p>If installed on OKD, the web console is extended for management of virtual machines.</p>
</div>
<div class="sect2">
<h3 id="requirements"><a class="anchor" href="#requirements"></a>Requirements</h3>
<div class="paragraph">
<p>A few requirements need to be met before you can begin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://kubernetes.io">Kubernetes</a> cluster
(<a href="https://github.com/openshift/origin">OpenShift</a>, Tectonic)</p>
</li>
<li>
<p><code>kubectl</code> client utility</p>
</li>
<li>
<p><code>git</code></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="minimum-cluster-requirements"><a class="anchor" href="#minimum-cluster-requirements"></a>Minimum Cluster Requirements</h4>
<div class="paragraph">
<p>Kubernetes 1.10 or later is required to run KubeVirt.</p>
</div>
<div class="paragraph">
<p>In addition it can be that feature gates need to be opened.</p>
</div>
</div>
<div class="sect3">
<h4 id="cluster-configuration"><a class="anchor" href="#cluster-configuration"></a>Cluster Configuration</h4>
<div class="paragraph">
<p>The Kubernetes apiserver needs to be configured to allow privileged pods since
we run a privileged Daemon Set on every node. The required flag is
<code>--allow-privileged=true</code>.</p>
</div>
<div class="sect4">
<h5 id="runtime"><a class="anchor" href="#runtime"></a>Runtime</h5>
<div class="paragraph">
<p>KubeVirt is currently supported on the following container runtimes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>docker</p>
</li>
<li>
<p>crio (with runv)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other container runtimes, which do not use virtualization features, should work
too. However, they are not tested.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="virtualization-support"><a class="anchor" href="#virtualization-support"></a>Virtualization support</h4>
<div class="paragraph">
<p>There are several distributions of Kubernetes, you need to decide on one
and deploy it.</p>
</div>
<div class="paragraph">
<p>Hardware with virtualization support is recommended. You can use
virt-host-validate to ensure that your hosts are capable of running
virtualization workloads:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ virt-host-validate qemu
  QEMU: Checking for hardware virtualization                                 : PASS
  QEMU: Checking if device /dev/kvm exists                                   : PASS
  QEMU: Checking if device /dev/kvm is accessible                            : PASS
  QEMU: Checking if device /dev/vhost-net exists                             : PASS
  QEMU: Checking if device /dev/net/tun exists                               : PASS
...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="software-emulation"><a class="anchor" href="#software-emulation"></a>Software emulation</h5>
<div class="paragraph">
<p>If hardware virtualization is not available, then a
<a href="https://github.com/kubevirt/kubevirt/blob/master/docs/software-emulation.md">software
emulation fallback</a> can be enabled using:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ kubectl create namespace kubevirt
$ kubectl create configmap -n kubevirt kubevirt-config \
    --from-literal debug.useEmulation=true</pre>
</div>
</div>
<div class="paragraph">
<p>This ConfigMap needs to be created before deployment or the
virt-controller deployment has to be restarted.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hugepages-support"><a class="anchor" href="#hugepages-support"></a>Hugepages support</h4>
<div class="paragraph">
<p>For hugepages support you need at least Kubernetes version <code>1.9</code>.</p>
</div>
<div class="sect4">
<h5 id="enable-feature-gate"><a class="anchor" href="#enable-feature-gate"></a>Enable feature-gate</h5>
<div class="paragraph">
<p>To enable hugepages on Kubernetes, check the
<a href="https://kubernetes.io/docs/tasks/manage-hugepages/scheduling-hugepages/">official
documentation</a>.</p>
</div>
<div class="paragraph">
<p>To enable hugepages on OKD, check the
<a href="https://docs.openshift.org/3.9/scaling_performance/managing_hugepages.html#huge-pages-prerequisites">official
documentation</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="pre-allocate-hugepages-on-a-node"><a class="anchor" href="#pre-allocate-hugepages-on-a-node"></a>Pre-allocate hugepages on a node</h5>
<div class="paragraph">
<p>To pre-allocate hugepages on boot time, you will need to specify
hugepages under kernel boot parameters <code>hugepagesz=2M hugepages=64</code> and
restart your machine.</p>
</div>
<div class="paragraph">
<p>You can find more about hugepages under
<a href="https://www.kernel.org/doc/Documentation/vm/hugetlbpage.txt">official
documentation</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cluster-side-add-on-deployment"><a class="anchor" href="#cluster-side-add-on-deployment"></a>Cluster side add-on deployment</h3>
<div class="sect3">
<h4 id="core-components"><a class="anchor" href="#core-components"></a>Core components</h4>
<div class="paragraph">
<p>Once Kubernetes is deployed, you will need to deploy the KubeVirt
add-on.</p>
</div>
<div class="paragraph">
<p>The installation uses the KubeVirt operator, which manages lifecycle of all KubeVirt core components:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># Deploy the KubeVirt operator
$ kubectl apply -f https://github.com/kubevirt/kubevirt/releases/download/v0.24.0/kubevirt-operator.yaml
# Create the KubeVirt CR (instance deployment request)
$ kubectl apply -f https://github.com/kubevirt/kubevirt/releases/download/v0.24.0/kubevirt-cr.yaml
# wait until all KubeVirt components is up
$ kubectl -n kubevirt wait kv kubevirt --for condition=Available</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Note: Prior to release v0.20.0 the condition for the <code>kubectl wait</code> command was named "Ready" instead of "Available"</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>All new components will be deployed under the <code>kubevirt</code> namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">kubectl get pods -n kubevirt
NAME                                           READY     STATUS        RESTARTS   AGE
virt-api-6d4fc3cf8a-b2ere                      1/1       Running       0          1m
virt-controller-5d9fc8cf8b-n5trt               1/1       Running       0          1m
virt-handler-vwdjx                             1/1       Running       0          1m
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restricting-virt-handler-daemonset"><a class="anchor" href="#restricting-virt-handler-daemonset"></a>Restricting virt-handler DaemonSet</h4>
<div class="paragraph">
<p>You can patch the <code>virt-handler</code> DaemonSet post-deployment to restrict it to a specific subset of nodes with
a nodeSelector. For example, to restrict the DaemonSet to only nodes with the "region=primary" label:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">kubectl patch ds/virt-handler -n kubevirt -p '{&quot;spec&quot;: {&quot;template&quot;: {&quot;spec&quot;: {&quot;nodeSelector&quot;: {&quot;region&quot;: &quot;primary&quot;}}}}}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deploying on OKD
<sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub>~</p>
</div>
<div class="paragraph">
<p>The following
<a href="https://docs.openshift.com/container-platform/3.11/admin_guide/manage_scc.html">SCC</a>
needs to be added prior KubeVirt deployment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ oc adm policy add-scc-to-user privileged -n kubevirt -z kubevirt-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once privileges are granted, the KubeVirt can be deployed as described above.</p>
</div>
<div class="paragraph">
<p>Web user interface on OKD
<sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup>^</p>
</div>
<div class="paragraph">
<p>No additional steps are required to extend OKD&#8217;s web console for KubeVirt.</p>
</div>
<div class="paragraph">
<p>The virtualization extension is automatically enabled when KubeVirt deployment is detected.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="client-side-code-virtctl-code-deployment"><a class="anchor" href="#client-side-code-virtctl-code-deployment"></a>Client side <code>virtctl</code> deployment</h3>
<div class="paragraph">
<p>Basic VirtualMachineInstance operations can be performed with the stock
<code>kubectl</code> utility. However, the <code>virtctl</code> binary utility is required to
use advanced features such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Serial and graphical console access</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It also provides convenience commands for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Starting and stopping VirtualMachineInstances</p>
</li>
<li>
<p>Live migrating VirtualMachineInstances</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are two ways to get it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the most recent version of the tool can be retrieved from the
<a href="https://github.com/kubevirt/kubevirt/releases">official release page</a></p>
</li>
<li>
<p>it can be installed as a <code>kubectl</code> plugin using <a href="https://krew.dev/">krew</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="install-code-virtctl-code-with-code-krew-code"><a class="anchor" href="#install-code-virtctl-code-with-code-krew-code"></a>Install <code>virtctl</code> with <code>krew</code></h5>
<div class="paragraph">
<p>It is required to <a href="https://github.com/kubernetes-sigs/krew/#installation">install <code>krew</code> plugin manager</a> beforehand.
If <code>krew</code> is installed, <code>virtctl</code> can be installed via <code>krew</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl krew install virt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then <code>virtctl</code> can be used as a kubectl plugin. For a list of available commands run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl virt help</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every occurrence throughout this guide of</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./virtctl &lt;command&gt;...</code></pre>
</div>
</div>
<div class="paragraph">
<p>should then be read as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl virt &lt;command&gt;...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="from-service-catalog-as-an-apb"><a class="anchor" href="#from-service-catalog-as-an-apb"></a>From Service Catalog as an APB</h4>
<div class="paragraph">
<p>You can find KubeVirt in the OKD Service Catalog and install it
from there. In order to do that please follow the documentation in the
<a href="https://github.com/ansibleplaybookbundle/kubevirt-apb">KubeVirt APB
repository</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploying-from-source"><a class="anchor" href="#deploying-from-source"></a>Deploying from Source</h3>
<div class="paragraph">
<p>See the
<a href="https://github.com/kubevirt/kubevirt/blob/master/docs/getting-started.md">Developer
Getting Started Guide</a> to understand how to build and deploy KubeVirt
from source.</p>
</div>
</div>
<div class="sect2">
<h3 id="installing-network-plugins-optional"><a class="anchor" href="#installing-network-plugins-optional"></a>Installing network plugins (optional)</h3>
<div class="paragraph">
<p>KubeVirt alone does not bring any additional network plugins, it just
allows user to utilize them. If you want to attach your VMs to multiple
networks (Multus CNI) or have full control over L2 (OVS CNI), you need
to deploy respective network plugins. For more information, refer to
<a href="https://github.com/kubevirt/ovs-cni/blob/master/docs/deployment-on-arbitrary-cluster.md">OVS
CNI installation guide</a>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Note: KubeVirt Ansible
<a href="https://github.com/kubevirt/kubevirt-ansible/tree/master/playbooks#network">network
playbook</a> installs these plugins by default.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="update"><a class="anchor" href="#update"></a>Update</h3>
<div class="paragraph">
<p>Zero downtime rolling updates are supported starting with release <code>v0.17.0</code>
onward. Updating from any release prior to the KubeVirt <code>v0.17.0</code> release is
not supported.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Note: Updating is only supported from N-1 to N release.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Updates are triggered one of two ways.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By changing the imageTag value in the KubeVirt CR&#8217;s spec.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, updating from <code>v0.17.0-alpha.1</code> to <code>v0.17.0</code> is as simple as
patching the KubeVirt CR with the <code>imageTag: v0.17.0</code> value. From there the
KubeVirt operator will begin the process of rolling out the new version of
KubeVirt. Existing VM/VMIs will remain uninterrupted both during and after
the update succeeds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl patch kv kubevirt -n kubevirt --type=json -p '[{ &quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/spec/imageTag&quot;, &quot;value&quot;: &quot;v0.17.0&quot; }]'</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Or, by updating the kubevirt operator if no imageTag value is set.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When no imageTag value is set in the kubevirt CR, the system assumes that the
version of KubeVirt is locked to the version of the operator. This means that
updating the operator will result in the underlying KubeVirt installation being
updated as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ export RELEASE=v0.17.0
$ kubectl apply -f https://github.com/kubevirt/kubevirt/releases/download/${RELEASE}/kubevirt-operator.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first way provides a fine granular approach where you have full control
over what version of KubeVirt is installed independently of what version of
the KubeVirt operator you might be running. The second approach allows you to
lock both the operator and operand to the same version.</p>
</div>
<div class="paragraph">
<p>Newer KubeVirt may require additional or extended RBAC rules. In this case, the #1 update method may fail,
because the virt-operator present in the cluster doesn&#8217;t have these RBAC rules itself.
In this case, you need to update the <code>virt-operator</code> first, and then proceed to update kubevirt.
See <a href="https://github.com/kubevirt/kubevirt/issues/2533">this issue for more details</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="delete"><a class="anchor" href="#delete"></a>Delete</h3>
<div class="paragraph">
<p>To delete the KubeVirt you should first to delete <code>KubeVirt</code> custom resource and then delete the KubeVirt operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ export RELEASE=v0.17.0
$ kubectl delete -n kubevirt kubevirt kubevirt --wait=true # --wait=true should anyway be default
$ kubectl delete apiservices v1alpha3.subresources.kubevirt.io # this needs to be deleted to avoid stuck terminating namespaces
$ kubectl delete mutatingwebhookconfigurations virt-api-mutator # not blocking but would be left over
$ kubectl delete validatingwebhookconfigurations virt-api-validator # not blocking but would be left over
$ kubectl delete -f https://github.com/kubevirt/kubevirt/releases/download/${RELEASE}/kubevirt-operator.yaml --wait=false</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Note: If by mistake you deleted the operator first, the KV custom resource will
get stuck in the <code>Terminating</code> state, to fix it, delete manually finalizer from
the resource.</p>
</div>
<div class="paragraph">
<p>Note: The <code>apiservice</code> and the <code>webhookconfigurations</code> need to be deleted manually
due to a bug.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ kubectl -n kubevirt patch kv kubevirt --type=json -p '[{ &quot;op&quot;: &quot;remove&quot;, &quot;path&quot;: &quot;/metadata/finalizers&quot; }]'</code></pre>
</div>
</div>
</blockquote>
</div>
</div>
</div>
</div>
      </div>
    </div>
  </div>
   <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
   <!-- Latest compiled and minified JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
   <script src="../../latest/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
   <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>